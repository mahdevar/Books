%TIKZ RELATED COMMANDS
\usepackage{tikz}
\usepackage{tikz-cd}
\usepackage{varwidth}
\usetikzlibrary{calc, datavisualization, fit, patterns, positioning, scopes, shapes}

\fboxrule=0.5pt

\FPeval\intensity{100*\@opacity}

\tikzset
{
	right to left/.style=
	{
		execute at begin node={\centering\begin{varwidth}{\textwidth}\@RTLtrue\footnotesize},
		execute at end node={\@RTLfalse\end{varwidth}}
	}
}

\tikzset
{
	color/.style={draw=#1, fill=#1!\intensity},
	edges/.style={align=center, minimum height=0, ->, shorten >= 0.5\tabcolsep, shorten <= 0.5\tabcolsep, line cap=round, line width=\fboxrule, rounded corners=1mm, every node/.append style={auto, font=\em, inner ysep=0.5\tabcolsep, width=3em-\tabcolsep}},
	highlights/.style={on background layer, every node/.append style={rectangle, fill opacity=\@opacity, draw opacity=0.5, inner sep=0.25\tabcolsep-0.25\pgflinewidth, pattern=checkerboard, pattern color=environment, draw=environment}}, %set "inner sep" to -0.5\pgflinewidth to remove spaces
	size/.style={width={#1}, minimum height={#1}},
	wide/.style={width=7.5em},
	width/.style={minimum width=#1,	text width=#1-2*(\pgfkeysvalueof{/pgf/inner xsep})-\pgflinewidth},
}

\tikzset
{
	every matrix/.style={matrix of nodes, row sep=3em, column sep=3em, nodes={anchor=center, inner sep=0.5\tabcolsep, size=5em}},
	every node/.style={align=none, font=\Kayhan, inner sep=0pt, line cap=round, line width=\fboxrule, right to left, rounded corners=1mm},
}

\newcommand\Style[2]
{
	\tikzset{#1/.append style={#2}}
}

%FLOWCHART
\Style{computation}{rectangle, color=blue}
\Style{decision}{diamond, color=violet, size=5.2em, outer sep=-0.23mm, inner sep=-1ex}
\Style{input}{trapezium, color=red, width=3.72em, trapezium left angle=60, trapezium right angle=120, trapezium stretches body}
\Style{junction}{circle, color=black, size=3em}
\Style{output}{tape, color=teal, minimum height=12ex, tape bend top=none, tape bend height=2ex}
\Style{terminator}{rectangle, color=black, rounded corners=1.67em}
\Style{two-sided}{commutative diagrams/shift left=1em}

%OBJECTS
\Style{activity}{rectangle, color=orange}
\Style{object}{circle, color=blue}
\Style{role}{circle, color=red}

%TIKZ FOOTNOTES
\def\TikzNewNoteMark#1.#2;{\node [anchor=#2, size=1em] at (#1.#2) {\NewNoteMark};}
\def\TikzLastNoteMark#1.#2;{\node [anchor=#2, size=1em] at (#1.#2) {\EndNoteMark{0}};}

%PUT PICTURES IN CENTER
\BeforeBeginEnvironment{tikzpicture}{\begin{center}}
\AfterEndEnvironment{tikzpicture}{\end{center}}